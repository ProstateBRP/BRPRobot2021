<?xml version="1.0" encoding="utf-8"?>
<executable>
  <category>ProstateBx</category>
  <title>HMS Marker Detection</title>
  <description>description</description>
  <version>0.3.1</version>
  <documentation-url>http://www.example.com/Slicer/Modules/HMS_Marker_Detection</documentation-url>
  <license></license>
  <contributor>Phill Marathakis, Nicole Aucoin (Harmonus Inc.)</contributor>
  <acknowledgements></acknowledgements>
  <parameters>
    <label>IO</label>
    <description><![CDATA[Input/output parameters]]></description>
    <image>
      <name>inputVolume</name>
      <label>Input Volume</label>
      <channel>input</channel>
      <index>0</index>
      <description><![CDATA[Input volume]]></description>
    </image>
    <file>
      <name>markerConfigFile</name>
      <label>Marker Config File</label>
      <channel>input</channel>
      <index>1</index>
      <description><![CDATA[Marker Configuration File]]></description>
      <default>markers.csv</default>
    </file>
    <image type="label">
        <name>outputVolume</name>
        <label>Output Volume</label>
        <channel>output</channel>
        <index>2</index>
        <description><![CDATA[Blurred Volume]]></description>
    </image>
    <transform fileExtensions=".txt">
      <name>markerTransform</name>
      <longflag>markertransform</longflag>
      <description><![CDATA[Position and orientation of detected marker.]]></description>
      <label>Marker transform</label>
      <channel>output</channel>
    </transform>
  </parameters>
  <parameters>
    <label>ZFrame Parameters</label>
    <description><![CDATA[ZFrame registration parameters]]></description>
    <integer>
      <name>startSlice</name>
      <longflag>--startSlice</longflag>
      <label>Start Slice</label>
      <description><![CDATA[Slice where marker labeling starts.]]></description>
      <default>0</default>
      <constraints>
	<minimum>0</minimum>
	<maximum>1024</maximum>
      </constraints>
    </integer>
    <integer>
      <name>endSlice</name>
      <longflag>-endSlice</longflag>
      <label>End Slice</label>
      <description><![CDATA[Slice where marker labeling ends.]]></description>
      <default>0</default>
      <constraints>
	<minimum>0</minimum>
	<maximum>1024</maximum>
      </constraints>
    </integer>
    <integer>
      <name>minFrameLocks</name>
      <longflag>-minFrameLocks</longflag>
      <label>Minimum Slices With Markers</label>
      <default>1</default>
      <constraints>
        <minimum>1</minimum>
        <maximum>10</maximum>
      </constraints>
      <description><![CDATA[The minimum number of slices on which all markers must be found.]]></description>
    </integer>
    <integer>
      <name>peakRadius</name>
      <longflag>-peakRadius</longflag>
      <label>Peak Radius</label>
      <default>13</default>
      <constraints>
        <minimum>1</minimum>
        <maximum>100</maximum>
      </constraints>
      <description><![CDATA[A voxel neighbourhood around a detected image peak where a marker intersects a slice.]]></description>
    </integer>
    <integer>
      <name>maxBadPeaks</name>
      <longflag>-maxBadPeaks</longflag>
      <label>Maximum Bad Peaks per Slice</label>
      <default>5</default>
      <constraints>
        <minimum>0</minimum>
        <maximum>100</maximum>
      </constraints>
      <description><![CDATA[Skip a slice when looking for markers if it contains too many bad peaks. A peak is bad if the off peak percent check fails. If an image is noisy, increase this setting.]]></description>
    </integer>
    <float>
      <name>offPeakPercent</name>
      <longflag>-offPeakPercent</longflag>
      <label>Off Peak Percent</label>
      <description><![CDATA[Classify a marker as bad if the off peak value, at peak radius away from the peak, is within this percentage of the peak's value. To ignore smaller marker cross sections, increase this value.]]></description>
      <default>0.9</default>
      <constraints>
        <minimum>0.0</minimum>
        <maximum>1.0</maximum>
      </constraints>
    </float>
    <double>
      <name>maxStdDevPos</name>
      <longflag>--maxStdDevPos</longflag>
      <label>Max Standard Deviation</label>
      <description><![CDATA[Fail registration if the standard deviation of the position over the frame locked slices is larger than this value along any axis.]]></description>
      <default>10.0</default>
      <constraints>
        <minimum>0.0</minimum>
        <maximum>100.0</maximum>
      </constraints>
    </double>
  </parameters>
  <parameters>
    <label>Output</label>
    <description><![CDATA[Registration output parameters.]]></description>
    <transform fileExtensions=".txt">
      <name>regSuccess</name>
      <label>Registration Success</label>
      <channel>output</channel>
      <index>3</index>
      <description><![CDATA[Did the registration find one unique solution? (element 0,0)]]></description>
    </transform>
    <string>
      <name>markerConfigurationID</name>
      <label>Marker Configuration ID</label>
      <channel>output</channel>
      <description><![CDATA[Identification of the marker configuration file used to generate the output transform.]]></description>
    </string>
    <string>
      <name>markerConfigurationDescription</name>
      <label>Marker Configuration Description</label>
      <channel>output</channel>
      <description><![CDATA[Description of the marker configuration file used to generate the output transform.]]></description>
    </string>
    <string>
      <name>markerConfigurationGridID</name>
      <label>Marker Configuration Grid ID</label>
      <channel>output</channel>
      <description><![CDATA[Identification of the ProBx Grid configuration file to be used with this marker configuration file.]]></description>
    </string>
    <integer>
      <name>returnCode</name>
      <label>Return Code</label>
      <channel>output</channel>
      <description><![CDATA[Return code from marker registration.]]></description>
    </integer>
    <string>
      <name>returnString</name>
      <label>Return Code Description</label>
      <channel>output</channel>
      <description><![CDATA[Description of return code from marker registration.]]></description>
    </string>
    <double-vector>
      <name>positionStdDev</name>
      <label>Position Standard Deviation</label>
      <channel>output</channel>
      <description><![CDATA[Standard deviation, for each axis, of the registered position.]]></description>
    </double-vector>
    <double-vector>
      <name>quaternionStdDev</name>
      <label>Quaternion Standard Deviation</label>
      <channel>output</channel>
      <description><![CDATA[Standard deviation, for X, Y, Z, W, of the registered quaternion.]]></description>
    </double-vector>
  </parameters>
  <parameters>
    <label>Marker Dimensions</label>
    <description><![CDATA[Descriptions of the markers.]]></description>
    <float>
      <name>minimumObjectSize</name>
      <longflag>--minimumObjectSize</longflag>
      <description><![CDATA[Minimum volume of marker to retain (mm^3). This parameter can be used to get rid of small regions in noisy images.]]></description>
      <label>Minimum Volume (mm^3)</label>
      <default>315</default>
    </float>
    <float>
      <name>maximumObjectSize</name>
      <longflag>--maximumObjectSize</longflag>
      <description><![CDATA[Maximum volume of marker to retain (mm^3). This parameter can be used to get rid of large regions.]]></description>
      <label>Maximum Volume (mm^3)</label>
      <default>3000</default>
    </float>
  </parameters>
  <parameters>
    <label>Mask Parameters</label>
    <description><![CDATA[Automatic mask algorithm parameters, passed to the image burn algorithm.]]></description>
    <float>
      <name>burnThresholdPercent</name>
      <longflag>--burnThresholdPercent</longflag>
      <description><![CDATA[The burn algorithm applies a threshold filter of this percent of the image's max value to separate the markers (bright) from the background (darker). May need adjusting if other bright features appear in the calibration scan.]]></description>
      <label>Mask Threshold Percent</label>
      <default>0.2</default>
      <constraints>
        <minimum>0.0</minimum>
        <maximum>1.0</maximum>
      </constraints>
    </float>
    <float>
      <name>surroundPercent</name>
      <longflag>--surroundPercent</longflag>
      <description><![CDATA[The burn algorithmm applies a surrounds filter on the output of the burn threshold filter. If voxel is at least Surround Percent surrounded by non-zero voxels in the 26 surrounding voxels (the 3x3x3 matrix centered on the voxel), then keep its value, otherwise set voxel value to 0.]]></description>
      <label>Surround Percent</label>
      <default>0.5</default>
      <constraints>
        <minimum>0.0</minimum>
        <maximum>1.0</maximum>
      </constraints>
    </float>
    <integer>
      <name>recursionLimit</name>
      <longflag>--recursionLimit</longflag>
      <description><![CDATA[To stop an overflow error occurring with the recursive nature of the burn algorithm, the recursions are limited.]]></description>
      <label>Recursion Limit</label>
      <default>5000</default>
    </integer>
    <integer>
      <name>binsPerDimension</name>
      <longflag>--binsPerDimension</longflag>
      <description><![CDATA[When histogramming the input image, how many bins to use along each dimension.]]></description>
      <label>Histogram Bins</label>
      <default>20</default>
      <constraints>
        <minimum>0</minimum>
        <maximum>100</maximum>
      </constraints>
    </integer>
    <integer>
      <name>histogramUpperBound</name>
      <longflag>--histogramUpperBound</longflag>
      <description><![CDATA[When histogramming the input image, upper bound on histogram bins (lower is 0).]]></description>
      <label>Histogram Bin Upper Bound</label>
      <default>255</default>
      <constraints>
        <minimum>0</minimum>
        <maximum>1000</maximum>
      </constraints>
    </integer>
    <boolean>
      <name>histogramAutoBounds</name>
      <label>Histogram Bin Auto Bounds</label>
      <description><![CDATA[Turn this flag on in order to automatically calculate the histogram bin upper bounds. When on, Histogram Bin Upper Bound is not used, processing time increases.]]></description>
      <longflag>--histogramAutoBounds</longflag>
      <default>false</default>
    </boolean>
  </parameters>
  <parameters advanced="true">
    <label>Advanced</label>
    <description>Advanced parameters</description>
    <boolean>
      <name>debug</name>
      <label>Debug</label>
      <description><![CDATA[Turn this flag on in order to see debugging output in the Error Log window that is accessed via the View menu.]]></description>
      <longflag>--debug</longflag>
      <default>false</default>
    </boolean>
    <integer>
      <name>burnFlag</name>
      <label>Masking</label>
      <description><![CDATA[When set to 1, use a burn algorithm to automatically mask the input volume to isolate markers before doing the ZFrame detection. Turn off this flag (set to 0) for legacy calibration scans.]]></description>
      <longflag>--burnFlag</longflag>
      <default>1</default>
      <constraints>
	<minimum>0</minimum>
	<maximum>1</maximum>
      </constraints>
    </integer>
  </parameters>
</executable>

